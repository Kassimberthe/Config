var Oe=Object.create;var fe=Object.defineProperty;var De=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var ge=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports);var Ce=(i,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Me(r))!Ne.call(i,a)&&a!==t&&fe(i,a,{get:()=>r[a],enumerable:!(e=De(r,a))||e.enumerable});return i};var ce=(i,r,t)=>(t=i!=null?Oe(Pe(i)):{},Ce(r||!i||!i.__esModule?fe(t,"default",{value:i,enumerable:!0}):t,i));var be=ge((Vt,Ae)=>{var q;typeof window<"u"?q=window:typeof global<"u"?q=global:typeof self<"u"?q=self:q={};Ae.exports=q});var ve=ge((me,xe)=>{(function(i,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof me<"u")r(xe);else{var t={exports:{}};r(t),i.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:me,function(i){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)i.exports=globalThis.browser;else{let r="The message port closed before a response was received.",t=e=>{let a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(f,c=void 0){super(c),this.createItem=f}get(f){return this.has(f)||this.set(f,this.createItem(f)),super.get(f)}}let o=m=>m&&typeof m=="object"&&typeof m.then=="function",l=(m,f)=>(...c)=>{e.runtime.lastError?m.reject(new Error(e.runtime.lastError.message)):f.singleCallbackArg||c.length<=1&&f.singleCallbackArg!==!1?m.resolve(c[0]):m.resolve(c)},g=m=>m==1?"argument":"arguments",u=(m,f)=>function(_,...w){if(w.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${g(f.minArgs)} for ${m}(), got ${w.length}`);if(w.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${g(f.maxArgs)} for ${m}(), got ${w.length}`);return new Promise((D,P)=>{if(f.fallbackToNoCallback)try{_[m](...w,l({resolve:D,reject:P},f))}catch(A){console.warn(`${m} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,A),_[m](...w),f.fallbackToNoCallback=!1,f.noCallback=!0,D()}else f.noCallback?(_[m](...w),D()):_[m](...w,l({resolve:D,reject:P},f))})},p=(m,f,c)=>new Proxy(f,{apply(_,w,D){return c.call(w,m,...D)}}),b=Function.call.bind(Object.prototype.hasOwnProperty),S=(m,f={},c={})=>{let _=Object.create(null),w={has(P,A){return A in m||A in _},get(P,A,N){if(A in _)return _[A];if(!(A in m))return;let x=m[A];if(typeof x=="function")if(typeof f[A]=="function")x=p(m,m[A],f[A]);else if(b(c,A)){let L=u(A,c[A]);x=p(m,m[A],L)}else x=x.bind(m);else if(typeof x=="object"&&x!==null&&(b(f,A)||b(c,A)))x=S(x,f[A],c[A]);else if(b(c,"*"))x=S(x,f[A],c["*"]);else return Object.defineProperty(_,A,{configurable:!0,enumerable:!0,get(){return m[A]},set(L){m[A]=L}}),x;return _[A]=x,x},set(P,A,N,x){return A in _?_[A]=N:m[A]=N,!0},defineProperty(P,A,N){return Reflect.defineProperty(_,A,N)},deleteProperty(P,A){return Reflect.deleteProperty(_,A)}},D=Object.create(m);return new Proxy(D,w)},y=m=>({addListener(f,c,..._){f.addListener(m.get(c),..._)},hasListener(f,c){return f.hasListener(m.get(c))},removeListener(f,c){f.removeListener(m.get(c))}}),T=new n(m=>typeof m!="function"?m:function(c){let _=S(c,{},{getContent:{minArgs:0,maxArgs:0}});m(_)}),s=new n(m=>typeof m!="function"?m:function(c,_,w){let D=!1,P,A=new Promise(z=>{P=function(C){D=!0,z(C)}}),N;try{N=m(c,_,P)}catch(z){N=Promise.reject(z)}let x=N!==!0&&o(N);if(N!==!0&&!x&&!D)return!1;let L=z=>{z.then(C=>{w(C)},C=>{let ee;C&&(C instanceof Error||typeof C.message=="string")?ee=C.message:ee="An unexpected error occurred",w({__mozWebExtensionPolyfillReject__:!0,message:ee})}).catch(C=>{console.error("Failed to send onMessage rejected reply",C)})};return L(x?N:A),!0}),k=({reject:m,resolve:f},c)=>{e.runtime.lastError?e.runtime.lastError.message===r?f():m(new Error(e.runtime.lastError.message)):c&&c.__mozWebExtensionPolyfillReject__?m(new Error(c.message)):f(c)},I=(m,f,c,..._)=>{if(_.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${g(f.minArgs)} for ${m}(), got ${_.length}`);if(_.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${g(f.maxArgs)} for ${m}(), got ${_.length}`);return new Promise((w,D)=>{let P=k.bind(null,{resolve:w,reject:D});_.push(P),c.sendMessage(..._)})},h={devtools:{network:{onRequestFinished:y(T)}},runtime:{onMessage:y(s),onMessageExternal:y(s),sendMessage:I.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:I.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},d={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":d},services:{"*":d},websites:{"*":d}},S(e,h,a)};i.exports=t(chrome)}})});function U(i){var r=String(i);if(r==="[object Object]")try{r=JSON.stringify(i)}catch{}return r}var Fe=(function(){function i(){}return i.prototype.isSome=function(){return!1},i.prototype.isNone=function(){return!0},i.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},i.prototype.unwrapOr=function(r){return r},i.prototype.expect=function(r){throw new Error("".concat(r))},i.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},i.prototype.map=function(r){return this},i.prototype.mapOr=function(r,t){return r},i.prototype.mapOrElse=function(r,t){return r()},i.prototype.or=function(r){return r},i.prototype.orElse=function(r){return r()},i.prototype.andThen=function(r){return this},i.prototype.toResult=function(r){return v(r)},i.prototype.toString=function(){return"None"},i.prototype.toAsyncOption=function(){return new G(E)},i})(),E=new Fe;Object.freeze(E);var ke=(function(){function i(r){if(!(this instanceof i))return new i(r);this.value=r}return i.prototype.isSome=function(){return!0},i.prototype.isNone=function(){return!1},i.prototype[Symbol.iterator]=function(){var r=Object(this.value);return Symbol.iterator in r?r[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},i.prototype.unwrapOr=function(r){return this.value},i.prototype.expect=function(r){return this.value},i.prototype.unwrap=function(){return this.value},i.prototype.map=function(r){return R(r(this.value))},i.prototype.mapOr=function(r,t){return t(this.value)},i.prototype.mapOrElse=function(r,t){return t(this.value)},i.prototype.or=function(r){return this},i.prototype.orElse=function(r){return this},i.prototype.andThen=function(r){return r(this.value)},i.prototype.toResult=function(r){return M(this.value)},i.prototype.toAsyncOption=function(){return new G(this)},i.prototype.safeUnwrap=function(){return this.value},i.prototype.toString=function(){return"Some(".concat(U(this.value),")")},i.EMPTY=new i(void 0),i})(),R=ke,K;(function(i){function r(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];for(var o=[],l=0,g=a;l<g.length;l++){var u=g[l];if(u.isSome())o.push(u.value);else return u}return R(o)}i.all=r;function t(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];for(var o=0,l=a;o<l.length;o++){var g=l[o];if(g.isSome())return g}return E}i.any=t;function e(a){return a instanceof R||a===E}i.isOption=e})(K||(K={}));var B=function(i,r,t){if(t||arguments.length===2)for(var e=0,a=r.length,n;e<a;e++)(n||!(e in r))&&(n||(n=Array.prototype.slice.call(r,0,e)),n[e]=r[e]);return i.concat(n||Array.prototype.slice.call(r))},Ue=(function(){function i(r){if(!(this instanceof i))return new i(r);this.error=r;var t=new Error().stack.split(`
`).slice(2);t&&t.length>0&&t[0].includes("ErrImpl")&&t.shift(),this._stack=t.join(`
`)}return i.prototype.isOk=function(){return!1},i.prototype.isErr=function(){return!0},i.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},i.prototype.else=function(r){return r},i.prototype.unwrapOr=function(r){return r},i.prototype.expect=function(r){throw new Error("".concat(r," - Error: ").concat(U(this.error),`
`).concat(this._stack),{cause:this.error})},i.prototype.expectErr=function(r){return this.error},i.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: ".concat(U(this.error),`
`).concat(this._stack),{cause:this.error})},i.prototype.unwrapErr=function(){return this.error},i.prototype.map=function(r){return this},i.prototype.andThen=function(r){return this},i.prototype.mapErr=function(r){return new v(r(this.error))},i.prototype.mapOr=function(r,t){return r},i.prototype.mapOrElse=function(r,t){return r(this.error)},i.prototype.or=function(r){return r},i.prototype.orElse=function(r){return r(this.error)},i.prototype.toOption=function(){return E},i.prototype.toString=function(){return"Err(".concat(U(this.error),")")},Object.defineProperty(i.prototype,"stack",{get:function(){return"".concat(this,`
`).concat(this._stack)},enumerable:!1,configurable:!0}),i.prototype.toAsyncResult=function(){return new H(this)},i.EMPTY=new i(void 0),i})();var v=Ue,Xe=(function(){function i(r){if(!(this instanceof i))return new i(r);this.value=r}return i.prototype.isOk=function(){return!0},i.prototype.isErr=function(){return!1},i.prototype[Symbol.iterator]=function(){var r=Object(this.value);return Symbol.iterator in r?r[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},i.prototype.else=function(r){return this.value},i.prototype.unwrapOr=function(r){return this.value},i.prototype.expect=function(r){return this.value},i.prototype.expectErr=function(r){throw new Error(r)},i.prototype.unwrap=function(){return this.value},i.prototype.unwrapErr=function(){throw new Error("Tried to unwrap Ok: ".concat(U(this.value)),{cause:this.value})},i.prototype.map=function(r){return new M(r(this.value))},i.prototype.andThen=function(r){return r(this.value)},i.prototype.mapErr=function(r){return this},i.prototype.mapOr=function(r,t){return t(this.value)},i.prototype.mapOrElse=function(r,t){return t(this.value)},i.prototype.or=function(r){return this},i.prototype.orElse=function(r){return this},i.prototype.toOption=function(){return R(this.value)},i.prototype.safeUnwrap=function(){return this.value},i.prototype.toString=function(){return"Ok(".concat(U(this.value),")")},i.prototype.toAsyncResult=function(){return new H(this)},i.EMPTY=new i(void 0),i})();var M=Xe,j;(function(i){function r(l){for(var g=[],u=1;u<arguments.length;u++)g[u-1]=arguments[u];for(var p=l===void 0?[]:Array.isArray(l)?l:B([l],g,!0),b=[],S=0,y=p;S<y.length;S++){var T=y[S];if(T.isOk())b.push(T.value);else return T}return new M(b)}i.all=r;function t(l){for(var g=[],u=1;u<arguments.length;u++)g[u-1]=arguments[u];for(var p=l===void 0?[]:Array.isArray(l)?l:B([l],g,!0),b=[],S=0,y=p;S<y.length;S++){var T=y[S];if(T.isOk())return T;b.push(T.error)}return new v(b)}i.any=t;function e(l){try{return new M(l())}catch(g){return new v(g)}}i.wrap=e;function a(l){try{return l().then(function(g){return new M(g)}).catch(function(g){return new v(g)})}catch(g){return Promise.resolve(new v(g))}}i.wrapAsync=a;function n(l){return l.reduce(function(g,u){var p=g[0],b=g[1];return u.isOk()?[B(B([],p,!0),[u.value],!1),b]:[p,B(B([],b,!0),[u.error],!1)]},[[],[]])}i.partition=n;function o(l){return l instanceof v||l instanceof M}i.isResult=o})(j||(j={}));var Q=function(i,r,t,e){function a(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function l(p){try{u(e.next(p))}catch(b){o(b)}}function g(p){try{u(e.throw(p))}catch(b){o(b)}}function u(p){p.done?n(p.value):a(p.value).then(l,g)}u((e=e.apply(i,r||[])).next())})},J=function(i,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},e,a,n,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(p){return g([u,p])}}function g(u){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(e=1,a&&(n=u[0]&2?a.return:u[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,u[1])).done)return n;switch(a=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=r.call(i,t)}catch(p){u=[6,p],a=0}finally{e=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},H=(function(){function i(r){this.promise=Promise.resolve(r)}return i.prototype.andThen=function(r){var t=this;return this.thenInternal(function(e){return Q(t,void 0,void 0,function(){var a;return J(this,function(n){return e.isErr()?[2,e]:(a=r(e.value),[2,a instanceof i?a.promise:a])})})})},i.prototype.map=function(r){var t=this;return this.thenInternal(function(e){return Q(t,void 0,void 0,function(){var a;return J(this,function(n){switch(n.label){case 0:return e.isErr()?[2,e]:(a=M,[4,r(e.value)]);case 1:return[2,a.apply(void 0,[n.sent()])]}})})})},i.prototype.mapErr=function(r){var t=this;return this.thenInternal(function(e){return Q(t,void 0,void 0,function(){var a;return J(this,function(n){switch(n.label){case 0:return e.isOk()?[2,e]:(a=v,[4,r(e.error)]);case 1:return[2,a.apply(void 0,[n.sent()])]}})})})},i.prototype.or=function(r){return this.orElse(function(){return r})},i.prototype.orElse=function(r){var t=this;return this.thenInternal(function(e){return Q(t,void 0,void 0,function(){var a;return J(this,function(n){return e.isOk()?[2,e]:(a=r(e.error),[2,a instanceof i?a.promise:a])})})})},i.prototype.toOption=function(){return new G(this.promise.then(function(r){return r.toOption()}))},i.prototype.thenInternal=function(r){return new i(this.promise.then(r))},i})();var te=function(i,r,t,e){function a(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function l(p){try{u(e.next(p))}catch(b){o(b)}}function g(p){try{u(e.throw(p))}catch(b){o(b)}}function u(p){p.done?n(p.value):a(p.value).then(l,g)}u((e=e.apply(i,r||[])).next())})},re=function(i,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},e,a,n,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(p){return g([u,p])}}function g(u){if(e)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(t=0)),t;)try{if(e=1,a&&(n=u[0]&2?a.return:u[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,u[1])).done)return n;switch(a=0,n&&(u=[u[0]&2,n.value]),u[0]){case 0:case 1:n=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){t.label=u[1];break}if(u[0]===6&&t.label<n[1]){t.label=n[1],n=u;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(u);break}n[2]&&t.ops.pop(),t.trys.pop();continue}u=r.call(i,t)}catch(p){u=[6,p],a=0}finally{e=n=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},G=(function(){function i(r){this.promise=Promise.resolve(r)}return i.prototype.andThen=function(r){var t=this;return this.thenInternal(function(e){return te(t,void 0,void 0,function(){var a;return re(this,function(n){return e.isNone()?[2,e]:(a=r(e.value),[2,a instanceof i?a.promise:a])})})})},i.prototype.map=function(r){var t=this;return this.thenInternal(function(e){return te(t,void 0,void 0,function(){var a;return re(this,function(n){switch(n.label){case 0:return e.isNone()?[2,e]:(a=R,[4,r(e.value)]);case 1:return[2,a.apply(void 0,[n.sent()])]}})})})},i.prototype.or=function(r){return this.orElse(function(){return r})},i.prototype.orElse=function(r){var t=this;return this.thenInternal(function(e){return te(t,void 0,void 0,function(){var a;return re(this,function(n){return e.isSome()?[2,e]:(a=r(),[2,a instanceof i?a.promise:a])})})})},i.prototype.toResult=function(r){return new H(this.promise.then(function(t){return t.toResult(r)}))},i.prototype.thenInternal=function(r){return new i(this.promise.then(r))},i})();function ie(i,r){let t=new URLSearchParams;for(let[e,a]of i)t.set(e,a);for(let[e,a]of r)t.set(e,a);return t.toString()}function $(i,r){try{if(i)return R(new URL(i,r))}catch{}return E}function F(i){if(typeof i=="string")return{__serde_tag:"primitive",__serde_val:i};if(typeof i=="number")return{__serde_tag:"primitive",__serde_val:i};if(typeof i=="boolean")return{__serde_tag:"primitive",__serde_val:i};if(typeof i>"u")return{__serde_tag:"primitive",__serde_val:i};if(i==null)return{__serde_tag:"primitive",__serde_val:i};if(Array.isArray(i))return{__serde_tag:"array",__serde_val:i.map(r=>F(r))};if(i instanceof URL)return{__serde_tag:"url",__serde_val:i.href};if(i instanceof Headers){let r=[];return i.forEach((t,e)=>{r.push([e,t])}),{__serde_tag:"headers",__serde_val:r}}else{if(i instanceof Set)return{__serde_tag:"set",__serde_val:[...i.values()].map(F)};if(i instanceof Map)return{__serde_tag:"map",__serde_val:[...i.entries()].map(([r,t])=>[F(r),F(t)])};if(i instanceof RegExp)return{__serde_tag:"regex",__serde_val:i.source};if(K.isOption(i))return i.isSome()?{__serde_tag:"some",__serde_val:F(i.value)}:{__serde_tag:"none"};if(j.isResult(i))return i.isOk()?{__serde_tag:"ok",__serde_val:F(i.value)}:{__serde_tag:"err",__serde_val:F(i.error)};if(typeof i=="object"){let r={};for(let[t,e]of Object.entries(i))r[t]=F(e);return{__serde_tag:"object",__serde_val:r}}else throw new Error("Unreachable")}}var Ve=["mp4","webm","mkv"],Le=["mp3","m4a","ogg"],Be=[...Ve,...Le];var $e=[{mime_reg:/avc1.*/i,demuxer:"mp4",codec:"H264"},{mime_reg:/(hvc1|hev1|hevc|h265|h\.265).*/i,demuxer:"mp4",codec:"H265"},{mime_reg:/mp4v\.20.*/i,demuxer:"mp4",codec:"MP4V"},{mime_reg:/av0?1.*/i,demuxer:"webm",codec:"AV1"},{mime_reg:/vp0?8.*/i,demuxer:"webm",codec:"VP8"},{mime_reg:/vp0?9.*/i,demuxer:"webm",codec:"VP9"}];function pe(i){for(let r of $e)if(r.mime_reg.test(i))return R(r.demuxer);return E}function Ge(i,r){let n=i.size.map(u=>u.height).unwrapOr(0),o=r.size.map(u=>u.height).unwrapOr(0),l=i.bitrate.unwrapOr(0),g=r.bitrate.unwrapOr(0);return n>o?-1:n<o?1:l>g?-1:l<g?1:0}function he(i){return[...i.values()].sort((r,t)=>Ge(r.quality,t.quality))}function ye(i){return i.length>0}var Z=(function(){function i(){this.listeners={}}var r=i.prototype;return r.on=function(e,a){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(a)},r.off=function(e,a){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(a);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},r.trigger=function(e){var a=this.listeners[e];if(a)if(arguments.length===2)for(var n=a.length,o=0;o<n;++o)a[o].call(this,arguments[1]);else for(var l=Array.prototype.slice.call(arguments,1),g=a.length,u=0;u<g;++u)a[u].apply(this,l)},r.dispose=function(){this.listeners={}},r.pipe=function(e){this.on("data",function(a){e.push(a)})},i})();function V(){return V=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var e in t)({}).hasOwnProperty.call(t,e)&&(i[e]=t[e])}return i},V.apply(null,arguments)}var ne=ce(be()),qe=function(r){return ne.default.atob?ne.default.atob(r):Buffer.from(r,"base64").toString("binary")};function ae(i){for(var r=qe(i),t=new Uint8Array(r.length),e=0;e<r.length;e++)t[e]=r.charCodeAt(e);return t}var ue=class extends Z{constructor(){super(),this.buffer=""}push(r){let t;for(this.buffer+=r,t=this.buffer.indexOf(`
`);t>-1;t=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}},We="	",se=function(i){let r=/([0-9.]*)?@?([0-9.]*)?/.exec(i||""),t={};return r[1]&&(t.length=parseInt(r[1],10)),r[2]&&(t.offset=parseInt(r[2],10)),t},Ye=function(){let t="(?:"+"[^=]*"+")=(?:"+'"[^"]*"|[^,]*'+")";return new RegExp("(?:^|,)("+t+")")},O=function(i){let r={};if(!i)return r;let t=i.split(Ye()),e=t.length,a;for(;e--;)t[e]!==""&&(a=/([^=]*)=(.*)/.exec(t[e]).slice(1),a[0]=a[0].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1"),r[a[0]]=a[1]);return r},_e=i=>{let r=i.split("x"),t={};return r[0]&&(t.width=parseInt(r[0],10)),r[1]&&(t.height=parseInt(r[1],10)),t},le=class extends Z{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(r){let t,e;if(r=r.trim(),r.length===0)return;if(r[0]!=="#"){this.trigger("data",{type:"uri",uri:r});return}this.tagMappers.reduce((n,o)=>{let l=o(r);return l===r?n:n.concat([l])},[r]).forEach(n=>{for(let o=0;o<this.customParsers.length;o++)if(this.customParsers[o].call(this,n))return;if(n.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:n.slice(1)});return}if(n=n.replace("\r",""),t=/^#EXTM3U/.exec(n),t){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(n),t){e={type:"tag",tagType:"inf"},t[1]&&(e.duration=parseFloat(t[1])),t[2]&&(e.title=t[2]),this.trigger("data",e);return}if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(n),t){e={type:"tag",tagType:"targetduration"},t[1]&&(e.duration=parseInt(t[1],10)),this.trigger("data",e);return}if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(n),t){e={type:"tag",tagType:"version"},t[1]&&(e.version=parseInt(t[1],10)),this.trigger("data",e);return}if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(n),t){e={type:"tag",tagType:"media-sequence"},t[1]&&(e.number=parseInt(t[1],10)),this.trigger("data",e);return}if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(n),t){e={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(e.number=parseInt(t[1],10)),this.trigger("data",e);return}if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(n),t){e={type:"tag",tagType:"playlist-type"},t[1]&&(e.playlistType=t[1]),this.trigger("data",e);return}if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(n),t){e=V(se(t[1]),{type:"tag",tagType:"byterange"}),this.trigger("data",e);return}if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(n),t){e={type:"tag",tagType:"allow-cache"},t[1]&&(e.allowed=!/NO/.test(t[1])),this.trigger("data",e);return}if(t=/^#EXT-X-MAP:(.*)$/.exec(n),t){if(e={type:"tag",tagType:"map"},t[1]){let o=O(t[1]);o.URI&&(e.uri=o.URI),o.BYTERANGE&&(e.byterange=se(o.BYTERANGE))}this.trigger("data",e);return}if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(n),t){e={type:"tag",tagType:"stream-inf"},t[1]&&(e.attributes=O(t[1]),e.attributes.RESOLUTION&&(e.attributes.RESOLUTION=_e(e.attributes.RESOLUTION)),e.attributes.BANDWIDTH&&(e.attributes.BANDWIDTH=parseInt(e.attributes.BANDWIDTH,10)),e.attributes["FRAME-RATE"]&&(e.attributes["FRAME-RATE"]=parseFloat(e.attributes["FRAME-RATE"])),e.attributes["PROGRAM-ID"]&&(e.attributes["PROGRAM-ID"]=parseInt(e.attributes["PROGRAM-ID"],10))),this.trigger("data",e);return}if(t=/^#EXT-X-MEDIA:(.*)$/.exec(n),t){e={type:"tag",tagType:"media"},t[1]&&(e.attributes=O(t[1])),this.trigger("data",e);return}if(t=/^#EXT-X-ENDLIST/.exec(n),t){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(t=/^#EXT-X-DISCONTINUITY/.exec(n),t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(n),t){e={type:"tag",tagType:"program-date-time"},t[1]&&(e.dateTimeString=t[1],e.dateTimeObject=new Date(t[1])),this.trigger("data",e);return}if(t=/^#EXT-X-KEY:(.*)$/.exec(n),t){e={type:"tag",tagType:"key"},t[1]&&(e.attributes=O(t[1]),e.attributes.IV&&(e.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(e.attributes.IV=e.attributes.IV.substring(2)),e.attributes.IV=e.attributes.IV.match(/.{8}/g),e.attributes.IV[0]=parseInt(e.attributes.IV[0],16),e.attributes.IV[1]=parseInt(e.attributes.IV[1],16),e.attributes.IV[2]=parseInt(e.attributes.IV[2],16),e.attributes.IV[3]=parseInt(e.attributes.IV[3],16),e.attributes.IV=new Uint32Array(e.attributes.IV))),this.trigger("data",e);return}if(t=/^#EXT-X-START:(.*)$/.exec(n),t){e={type:"tag",tagType:"start"},t[1]&&(e.attributes=O(t[1]),e.attributes["TIME-OFFSET"]=parseFloat(e.attributes["TIME-OFFSET"]),e.attributes.PRECISE=/YES/.test(e.attributes.PRECISE)),this.trigger("data",e);return}if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(n),t){e={type:"tag",tagType:"cue-out-cont"},t[1]?e.data=t[1]:e.data="",this.trigger("data",e);return}if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(n),t){e={type:"tag",tagType:"cue-out"},t[1]?e.data=t[1]:e.data="",this.trigger("data",e);return}if(t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(n),t){e={type:"tag",tagType:"cue-in"},t[1]?e.data=t[1]:e.data="",this.trigger("data",e);return}if(t=/^#EXT-X-SKIP:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"skip"},e.attributes=O(t[1]),e.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(e.attributes["SKIPPED-SEGMENTS"]=parseInt(e.attributes["SKIPPED-SEGMENTS"],10)),e.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(e.attributes["RECENTLY-REMOVED-DATERANGES"]=e.attributes["RECENTLY-REMOVED-DATERANGES"].split(We)),this.trigger("data",e);return}if(t=/^#EXT-X-PART:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"part"},e.attributes=O(t[1]),["DURATION"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=parseFloat(e.attributes[o]))}),["INDEPENDENT","GAP"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=/YES/.test(e.attributes[o]))}),e.attributes.hasOwnProperty("BYTERANGE")&&(e.attributes.byterange=se(e.attributes.BYTERANGE)),this.trigger("data",e);return}if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"server-control"},e.attributes=O(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=parseFloat(e.attributes[o]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=/YES/.test(e.attributes[o]))}),this.trigger("data",e);return}if(t=/^#EXT-X-PART-INF:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"part-inf"},e.attributes=O(t[1]),["PART-TARGET"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=parseFloat(e.attributes[o]))}),this.trigger("data",e);return}if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"preload-hint"},e.attributes=O(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(o){if(e.attributes.hasOwnProperty(o)){e.attributes[o]=parseInt(e.attributes[o],10);let l=o==="BYTERANGE-LENGTH"?"length":"offset";e.attributes.byterange=e.attributes.byterange||{},e.attributes.byterange[l]=e.attributes[o],delete e.attributes[o]}}),this.trigger("data",e);return}if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"rendition-report"},e.attributes=O(t[1]),["LAST-MSN","LAST-PART"].forEach(function(o){e.attributes.hasOwnProperty(o)&&(e.attributes[o]=parseInt(e.attributes[o],10))}),this.trigger("data",e);return}if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(n),t&&t[1]){e={type:"tag",tagType:"daterange"},e.attributes=O(t[1]),["ID","CLASS"].forEach(function(l){e.attributes.hasOwnProperty(l)&&(e.attributes[l]=String(e.attributes[l]))}),["START-DATE","END-DATE"].forEach(function(l){e.attributes.hasOwnProperty(l)&&(e.attributes[l]=new Date(e.attributes[l]))}),["DURATION","PLANNED-DURATION"].forEach(function(l){e.attributes.hasOwnProperty(l)&&(e.attributes[l]=parseFloat(e.attributes[l]))}),["END-ON-NEXT"].forEach(function(l){e.attributes.hasOwnProperty(l)&&(e.attributes[l]=/YES/i.test(e.attributes[l]))}),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach(function(l){e.attributes.hasOwnProperty(l)&&(e.attributes[l]=e.attributes[l].toString(16))});let o=/^X-([A-Z]+-)+[A-Z]+$/;for(let l in e.attributes){if(!o.test(l))continue;let g=/[0-9A-Fa-f]{6}/g.test(e.attributes[l]),u=/^\d+(\.\d+)?$/.test(e.attributes[l]);e.attributes[l]=g?e.attributes[l].toString(16):u?parseFloat(e.attributes[l]):String(e.attributes[l])}this.trigger("data",e);return}if(t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(n),t){this.trigger("data",{type:"tag",tagType:"independent-segments"});return}if(t=/^#EXT-X-I-FRAMES-ONLY/.exec(n),t){this.trigger("data",{type:"tag",tagType:"i-frames-only"});return}if(t=/^#EXT-X-CONTENT-STEERING:(.*)$/.exec(n),t){e={type:"tag",tagType:"content-steering"},e.attributes=O(t[1]),this.trigger("data",e);return}if(t=/^#EXT-X-I-FRAME-STREAM-INF:(.*)$/.exec(n),t){e={type:"tag",tagType:"i-frame-playlist"},e.attributes=O(t[1]),e.attributes.URI&&(e.uri=e.attributes.URI),e.attributes.BANDWIDTH&&(e.attributes.BANDWIDTH=parseInt(e.attributes.BANDWIDTH,10)),e.attributes.RESOLUTION&&(e.attributes.RESOLUTION=_e(e.attributes.RESOLUTION)),e.attributes["AVERAGE-BANDWIDTH"]&&(e.attributes["AVERAGE-BANDWIDTH"]=parseInt(e.attributes["AVERAGE-BANDWIDTH"],10)),e.attributes["FRAME-RATE"]&&(e.attributes["FRAME-RATE"]=parseFloat(e.attributes["FRAME-RATE"])),this.trigger("data",e);return}if(t=/^#EXT-X-DEFINE:(.*)$/.exec(n),t){e={type:"tag",tagType:"define"},e.attributes=O(t[1]),this.trigger("data",e);return}this.trigger("data",{type:"tag",data:n.slice(4)})})}addParser({expression:r,customType:t,dataParser:e,segment:a}){typeof e!="function"&&(e=n=>n),this.customParsers.push(n=>{if(r.exec(n))return this.trigger("data",{type:"custom",data:e(n),customType:t,segment:a}),!0})}addTagMapper({expression:r,map:t}){let e=a=>r.test(a)?t(a):a;this.tagMappers.push(e)}},Ke=i=>i.toLowerCase().replace(/-(\w)/g,r=>r[1].toUpperCase()),X=function(i){let r={};return Object.keys(i).forEach(function(t){r[Ke(t)]=i[t]}),r},oe=function(i){let{serverControl:r,targetDuration:t,partTargetDuration:e}=i;if(!r)return;let a="#EXT-X-SERVER-CONTROL",n="holdBack",o="partHoldBack",l=t&&t*3,g=e&&e*2;t&&!r.hasOwnProperty(n)&&(r[n]=l,this.trigger("info",{message:`${a} defaulting HOLD-BACK to targetDuration * 3 (${l}).`})),l&&r[n]<l&&(this.trigger("warn",{message:`${a} clamping HOLD-BACK (${r[n]}) to targetDuration * 3 (${l})`}),r[n]=l),e&&!r.hasOwnProperty(o)&&(r[o]=e*3,this.trigger("info",{message:`${a} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${r[o]}).`})),e&&r[o]<g&&(this.trigger("warn",{message:`${a} clamping PART-HOLD-BACK (${r[o]}) to partTargetDuration * 2 (${g}).`}),r[o]=g)},W=class extends Z{constructor(r={}){super(),this.lineStream=new ue,this.parseStream=new le,this.lineStream.pipe(this.parseStream),this.mainDefinitions=r.mainDefinitions||{},this.params=new URL(r.uri,"https://a.com").searchParams,this.lastProgramDateTime=null;let t=this,e=[],a={},n,o,l=!1,g=function(){},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},p="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",b=0;this.manifest={allowCache:!0,discontinuityStarts:[],dateRanges:[],iFramePlaylists:[],segments:[]};let S=0,y=0,T={};this.on("end",()=>{a.uri||!a.parts&&!a.preloadHints||(!a.map&&n&&(a.map=n),!a.key&&o&&(a.key=o),!a.timeline&&typeof b=="number"&&(a.timeline=b),this.manifest.preloadSegment=a)}),this.parseStream.on("data",function(s){let k,I;if(t.manifest.definitions){for(let h in t.manifest.definitions)if(s.uri&&(s.uri=s.uri.replace(`{$${h}}`,t.manifest.definitions[h])),s.attributes)for(let d in s.attributes)typeof s.attributes[d]=="string"&&(s.attributes[d]=s.attributes[d].replace(`{$${h}}`,t.manifest.definitions[h]))}({tag(){({version(){s.version&&(this.manifest.version=s.version)},"allow-cache"(){this.manifest.allowCache=s.allowed,"allowed"in s||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){let h={};"length"in s&&(a.byterange=h,h.length=s.length,"offset"in s||(s.offset=S)),"offset"in s&&(a.byterange=h,h.offset=s.offset),S=h.offset+h.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),s.title&&(a.title=s.title),s.duration>0&&(a.duration=s.duration),s.duration===0&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=e},key(){if(!s.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(s.attributes.METHOD==="NONE"){o=null;return}if(!s.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(s.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:s.attributes};return}if(s.attributes.KEYFORMAT==="com.microsoft.playready"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.microsoft.playready"]={uri:s.attributes.URI};return}if(s.attributes.KEYFORMAT===p){if(["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(s.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(s.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),s.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(s.attributes.KEYID&&s.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:s.attributes.KEYFORMAT,keyId:s.attributes.KEYID.substring(2)},pssh:ae(s.attributes.URI.split(",")[1])};return}s.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),o={method:s.attributes.METHOD||"AES-128",uri:s.attributes.URI},typeof s.attributes.IV<"u"&&(o.iv=s.attributes.IV)},"media-sequence"(){if(!isFinite(s.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+s.number});return}this.manifest.mediaSequence=s.number},"discontinuity-sequence"(){if(!isFinite(s.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+s.number});return}this.manifest.discontinuitySequence=s.number,b=s.number},"playlist-type"(){if(!/VOD|EVENT/.test(s.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+s.playlist});return}this.manifest.playlistType=s.playlistType},map(){n={},s.uri&&(n.uri=s.uri),s.byterange&&(n.byterange=s.byterange),o&&(n.key=o)},"stream-inf"(){if(this.manifest.playlists=e,this.manifest.mediaGroups=this.manifest.mediaGroups||u,!s.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}a.attributes||(a.attributes={}),V(a.attributes,s.attributes)},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||u,!(s.attributes&&s.attributes.TYPE&&s.attributes["GROUP-ID"]&&s.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}let h=this.manifest.mediaGroups[s.attributes.TYPE];h[s.attributes["GROUP-ID"]]=h[s.attributes["GROUP-ID"]]||{},k=h[s.attributes["GROUP-ID"]],I={default:/yes/i.test(s.attributes.DEFAULT)},I.default?I.autoselect=!0:I.autoselect=/yes/i.test(s.attributes.AUTOSELECT),s.attributes.LANGUAGE&&(I.language=s.attributes.LANGUAGE),s.attributes.URI&&(I.uri=s.attributes.URI),s.attributes["INSTREAM-ID"]&&(I.instreamId=s.attributes["INSTREAM-ID"]),s.attributes.CHARACTERISTICS&&(I.characteristics=s.attributes.CHARACTERISTICS),s.attributes.FORCED&&(I.forced=/yes/i.test(s.attributes.FORCED)),k[s.attributes.NAME]=I},discontinuity(){b+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(e.length)},"program-date-time"(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=s.dateTimeString,this.manifest.dateTimeObject=s.dateTimeObject),a.dateTimeString=s.dateTimeString,a.dateTimeObject=s.dateTimeObject;let{lastProgramDateTime:h}=this;this.lastProgramDateTime=new Date(s.dateTimeString).getTime(),h===null&&this.manifest.segments.reduceRight((d,m)=>(m.programDateTime=d-m.duration*1e3,m.programDateTime),this.lastProgramDateTime)},targetduration(){if(!isFinite(s.duration)||s.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+s.duration});return}this.manifest.targetDuration=s.duration,oe.call(this,this.manifest)},start(){if(!s.attributes||isNaN(s.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:s.attributes["TIME-OFFSET"],precise:s.attributes.PRECISE}},"cue-out"(){a.cueOut=s.data},"cue-out-cont"(){a.cueOutCont=s.data},"cue-in"(){a.cueIn=s.data},skip(){this.manifest.skip=X(s.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",s.attributes,["SKIPPED-SEGMENTS"])},part(){l=!0;let h=this.manifest.segments.length,d=X(s.attributes);a.parts=a.parts||[],a.parts.push(d),d.byterange&&(d.byterange.hasOwnProperty("offset")||(d.byterange.offset=y),y=d.byterange.offset+d.byterange.length);let m=a.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${m} for segment #${h}`,s.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((f,c)=>{f.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${c} lacks required attribute(s): LAST-PART`})})},"server-control"(){let h=this.manifest.serverControl=X(s.attributes);h.hasOwnProperty("canBlockReload")||(h.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),oe.call(this,this.manifest),h.canSkipDateranges&&!h.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){let h=this.manifest.segments.length,d=X(s.attributes),m=d.type&&d.type==="PART";a.preloadHints=a.preloadHints||[],a.preloadHints.push(d),d.byterange&&(d.byterange.hasOwnProperty("offset")||(d.byterange.offset=m?y:0,m&&(y=d.byterange.offset+d.byterange.length)));let f=a.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${f} for segment #${h}`,s.attributes,["TYPE","URI"]),!!d.type)for(let c=0;c<a.preloadHints.length-1;c++){let _=a.preloadHints[c];_.type&&_.type===d.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${f} for segment #${h} has the same TYPE ${d.type} as preload hint #${c}`})}},"rendition-report"(){let h=X(s.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(h);let d=this.manifest.renditionReports.length-1,m=["LAST-MSN","URI"];l&&m.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${d}`,s.attributes,m)},"part-inf"(){this.manifest.partInf=X(s.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",s.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),oe.call(this,this.manifest)},daterange(){this.manifest.dateRanges.push(X(s.attributes));let h=this.manifest.dateRanges.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${h}`,s.attributes,["ID","START-DATE"]);let d=this.manifest.dateRanges[h];d.endDate&&d.startDate&&new Date(d.endDate)<new Date(d.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),d.duration&&d.duration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),d.plannedDuration&&d.plannedDuration<0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});let m=!!d.endOnNext;if(m&&!d.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),m&&(d.duration||d.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),d.duration&&d.endDate){let c=d.startDate.getTime()+d.duration*1e3;this.manifest.dateRanges[h].endDate=new Date(c)}if(!T[d.id])T[d.id]=d;else{for(let c in T[d.id])if(d[c]&&JSON.stringify(T[d.id][c])!==JSON.stringify(d[c])){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes values"});break}let f=this.manifest.dateRanges.findIndex(c=>c.id===d.id);this.manifest.dateRanges[f]=V(this.manifest.dateRanges[f],d),T[d.id]=V(T[d.id],d),this.manifest.dateRanges.pop()}},"independent-segments"(){this.manifest.independentSegments=!0},"i-frames-only"(){this.manifest.iFramesOnly=!0,this.requiredCompatibilityversion(this.manifest.version,4)},"content-steering"(){this.manifest.contentSteering=X(s.attributes),this.warnOnMissingAttributes_("#EXT-X-CONTENT-STEERING",s.attributes,["SERVER-URI"])},define(){this.manifest.definitions=this.manifest.definitions||{};let h=(d,m)=>{if(d in this.manifest.definitions){this.trigger("error",{message:`EXT-X-DEFINE: Duplicate name ${d}`});return}this.manifest.definitions[d]=m};if("QUERYPARAM"in s.attributes){if("NAME"in s.attributes||"IMPORT"in s.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}let d=this.params.get(s.attributes.QUERYPARAM);if(!d){this.trigger("error",{message:`EXT-X-DEFINE: No query param ${s.attributes.QUERYPARAM}`});return}h(s.attributes.QUERYPARAM,decodeURIComponent(d));return}if("NAME"in s.attributes){if("IMPORT"in s.attributes){this.trigger("error",{message:"EXT-X-DEFINE: Invalid attributes"});return}if(!("VALUE"in s.attributes)||typeof s.attributes.VALUE!="string"){this.trigger("error",{message:`EXT-X-DEFINE: No value for ${s.attributes.NAME}`});return}h(s.attributes.NAME,s.attributes.VALUE);return}if("IMPORT"in s.attributes){if(!this.mainDefinitions[s.attributes.IMPORT]){this.trigger("error",{message:`EXT-X-DEFINE: No value ${s.attributes.IMPORT} to import, or IMPORT used on main playlist`});return}h(s.attributes.IMPORT,this.mainDefinitions[s.attributes.IMPORT]);return}this.trigger("error",{message:"EXT-X-DEFINE: No attribute"})},"i-frame-playlist"(){this.manifest.iFramePlaylists.push({attributes:s.attributes,uri:s.uri,timeline:b}),this.warnOnMissingAttributes_("#EXT-X-I-FRAME-STREAM-INF",s.attributes,["BANDWIDTH","URI"])}}[s.tagType]||g).call(t)},uri(){a.uri=s.uri,e.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),o&&(a.key=o),a.timeline=b,n&&(a.map=n),y=0,this.lastProgramDateTime!==null&&(a.programDateTime=this.lastProgramDateTime,this.lastProgramDateTime+=a.duration*1e3),a={}},comment(){},custom(){s.segment?(a.custom=a.custom||{},a.custom[s.customType]=s.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[s.customType]=s.data)}})[s.type].call(t)})}requiredCompatibilityversion(r,t){(r<t||!r)&&this.trigger("warn",{message:`manifest must be at least version ${t}`})}warnOnMissingAttributes_(r,t,e){let a=[];e.forEach(function(n){t.hasOwnProperty(n)||a.push(n)}),a.length&&this.trigger("warn",{message:`${r} lacks required attribute(s): ${a.join(", ")}`})}push(r){this.lineStream.push(r)}end(){this.lineStream.push(`
`),this.manifest.dateRanges.length&&this.lastProgramDateTime===null&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),this.lastProgramDateTime=null,this.trigger("end")}addParser(r){this.parseStream.addParser(r)}addTagMapper(r){this.parseStream.addTagMapper(r)}};function je(i){let r;try{let e=new W;e.push(i),e.end(),r=e.manifest}catch{}if(!r)return v("parse error");let t=r.segments;return Array.isArray(t)&&t.length>0?M(r):v("not a valid m3u8")}function Qe(i){let r=new Date(new Date().getTime()-6e5);return!i.dateTimeObject&&!i.programDateTime?!1:typeof i.dateTimeObject=="object"?i.dateTimeObject>r:typeof i.programDateTime=="number"?i.programDateTime>r.getTime():!1}function Je(i){if(!Array.isArray(i.segments)||i.segments.some(e=>typeof e.duration!="number"))return"unknown";let r=i.segments[i.segments.length-1];return r&&Qe(r)?"live":i.segments.reduce((e,a)=>(typeof a.duration=="number"&&(e+=a.duration),e),0)}async function Te(i,r,t,e,a=!1,n=!1){let o;try{let y=new W;y.push(i),y.end(),o=y.manifest}catch{}if(!o)return v("parse error");if(!o.playlists)return v("Not a master M3U8");let l=o.playlists,g=o.mediaGroups.AUDIO??{},u=[];for(let y of l){if(typeof y.uri!="string")continue;let T="mp4";if(y.attributes.CODECS){let m=pe(y.attributes.CODECS);if(m.isNone())continue;T=m.value}if(!("FRAME-RATE"in y.attributes)&&"RESOLUTION"in y.attributes,y.attributes["VIDEO-RANGE"]&&y.attributes["VIDEO-RANGE"]=="PQ")continue;let s=$(y.uri,r.href),k=E;if(y.attributes.AUDIO){let m=g[y.attributes.AUDIO];if(m){for(let f of Object.values(m))if(f.uri&&(k=$(f.uri,r.href)),e.isSome()&&f.language&&e.value.includes(f.language)||f.default)break}}let I=E,h=E;y.attributes.RESOLUTION&&(I=R({height:y.attributes.RESOLUTION.height,width:y.attributes.RESOLUTION.width})),y.attributes.BANDWIDTH&&(h=R(y.attributes.BANDWIDTH));let d={size:I,bitrate:h};if(s.isSome()){let m=s.value;if(a?m.search=ie(m.searchParams,r.searchParams):n&&(m.search=""),k.isSome()){let f=k.value;a?f.search=ie(m.searchParams,r.searchParams):n&&(f.search=""),u.push({demuxer:T,quality:d,av:{video:m,audio:f}})}else u.push({demuxer:T,quality:d,av:{video:m,audio:!1}})}}let p=u[0]?.av;if(!p)return v("Empty playlist");let b="unknown",S=p.video||p.audio;try{let T=await(await fetch(S,{headers:t,signal:AbortSignal.timeout(5e3)})).text(),s=je(T);s.isOk()&&(b=Je(s.value))}catch{console.warn("request timeout while calculating duration")}return u=he(u),ye(u)?M([u,b]):v("Empty playlist")}function Ee(i,r=0){let t=3735928559^r,e=1103547991^r;for(let a=0,n;a<i.length;a++)n=i.charCodeAt(a),t=Math.imul(t^n,2654435761),e=Math.imul(e^n,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(e^e>>>13,3266489909),e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&e)+(t>>>0)}var Se=ce(ve(),1);var nr=new BroadcastChannel("worker_service");var de={FromInjectedToService:0,FromContentToService:1,FromServiceToWorker:2,FromWorkerToService:3,FromUntrustedInjectedToTrusted:4,FromTrustedInjectedToUntrusted:5,FromServiceToContent:6,FromServiceToInjected:7,FromServiceToService:8};async function Ze(i,r){await Se.default.runtime.sendMessage({msg:i,channel:r})}function we(i){let r=de.FromInjectedToService;Ze(i,r)}var Re=!1,Ie,Y;function tt(){if(!window.location.href.match(/ok\.ru\/video/))return;let i=window.location.href.match(/ok\.ru\/video\/([^\/]+)/);i&&i.length>1&&(Y=i[1])}async function rt(i){let r=`https://ok.ru/videoembed/${i}?nochat=1`,e=await(await fetch(r)).text(),a=it(e);if(!a)return;let n=new URL(a.m3u8_url),o=await fetch(n);if(!o.ok)return;let l=await o.text(),g=await Te(l,n,new Headers,E);if(g.isOk()){let[u,p]=g.value,b={is_youtube:!1,master_url:n,prefered_entry:E,initiator:$(window.location.href),hash:`media_hash_${Ee(n.href)}`,sent_headers:new Headers,thumbnail_url:$(a.thumbnail_url),title:R(a.title),type:"m3u8_playlist",playlist:u,duration:p,discovery_timestamp_ms:Date.now()};we({name:"on_media",data:{media:F(b)}})}}function it(i){let e=new DOMParser().parseFromString(i,"text/html").querySelectorAll("div[data-options]");for(let a of e){let n=a.getAttribute("data-options");if(!n)continue;let o=JSON.parse(n);if(!o||!o.flashvars||!o.flashvars.metadata)continue;let l=JSON.parse(o.flashvars.metadata);if(!l||!l.movie)continue;let g=l.movie.title,u=l.movie.poster,p=l.hlsManifestUrl;if(!(!g||!u||!p))return{title:g,thumbnail_url:u,m3u8_url:p}}}async function nt(){if(!Re)for(Re=!0;;){if(tt(),!Y||Y==Ie){await new Promise(i=>setTimeout(i,300));continue}Ie=Y,await rt(Y)}}nt();
/*! Bundled license information:

m3u8-parser/dist/m3u8-parser.es.js:
  (*! @name m3u8-parser @version 7.2.0 @license Apache-2.0 *)
*/
