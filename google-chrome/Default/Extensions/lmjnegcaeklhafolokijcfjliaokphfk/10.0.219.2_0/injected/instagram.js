var ce=Object.create;var ne=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var ge=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var he=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var _e=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of ge(r))!pe.call(e,s)&&s!==t&&ne(e,s,{get:()=>r[s],enumerable:!(o=de(r,s))||o.enumerable});return e};var Ae=(e,r,t)=>(t=e!=null?ce(fe(e)):{},_e(r||!e||!e.__esModule?ne(t,"default",{value:e,enumerable:!0}):t,e));var ae=he((Q,ie)=>{(function(e,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof Q<"u")r(ie);else{var t={exports:{}};r(t),e.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Q,function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{let r="The message port closed before a response was received.",t=o=>{let s={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(s).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(l,f=void 0){super(f),this.createItem=l}get(l){return this.has(l)||this.set(l,this.createItem(l)),super.get(l)}}let c=a=>a&&typeof a=="object"&&typeof a.then=="function",u=(a,l)=>(...f)=>{o.runtime.lastError?a.reject(new Error(o.runtime.lastError.message)):l.singleCallbackArg||f.length<=1&&l.singleCallbackArg!==!1?a.resolve(f[0]):a.resolve(f)},m=a=>a==1?"argument":"arguments",i=(a,l)=>function(p,...v){if(v.length<l.minArgs)throw new Error(`Expected at least ${l.minArgs} ${m(l.minArgs)} for ${a}(), got ${v.length}`);if(v.length>l.maxArgs)throw new Error(`Expected at most ${l.maxArgs} ${m(l.maxArgs)} for ${a}(), got ${v.length}`);return new Promise((S,T)=>{if(l.fallbackToNoCallback)try{p[a](...v,u({resolve:S,reject:T},l))}catch(g){console.warn(`${a} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),p[a](...v),l.fallbackToNoCallback=!1,l.noCallback=!0,S()}else l.noCallback?(p[a](...v),S()):p[a](...v,u({resolve:S,reject:T},l))})},d=(a,l,f)=>new Proxy(l,{apply(p,v,S){return f.call(v,a,...S)}}),h=Function.call.bind(Object.prototype.hasOwnProperty),w=(a,l={},f={})=>{let p=Object.create(null),v={has(T,g){return g in a||g in p},get(T,g,k){if(g in p)return p[g];if(!(g in a))return;let _=a[g];if(typeof _=="function")if(typeof l[g]=="function")_=d(a,a[g],l[g]);else if(h(f,g)){let P=i(g,f[g]);_=d(a,a[g],P)}else _=_.bind(a);else if(typeof _=="object"&&_!==null&&(h(l,g)||h(f,g)))_=w(_,l[g],f[g]);else if(h(f,"*"))_=w(_,l[g],f["*"]);else return Object.defineProperty(p,g,{configurable:!0,enumerable:!0,get(){return a[g]},set(P){a[g]=P}}),_;return p[g]=_,_},set(T,g,k,_){return g in p?p[g]=k:a[g]=k,!0},defineProperty(T,g,k){return Reflect.defineProperty(p,g,k)},deleteProperty(T,g){return Reflect.deleteProperty(p,g)}},S=Object.create(a);return new Proxy(S,v)},b=a=>({addListener(l,f,...p){l.addListener(a.get(f),...p)},hasListener(l,f){return l.hasListener(a.get(f))},removeListener(l,f){l.removeListener(a.get(f))}}),y=new n(a=>typeof a!="function"?a:function(f){let p=w(f,{},{getContent:{minArgs:0,maxArgs:0}});a(p)}),W=new n(a=>typeof a!="function"?a:function(f,p,v){let S=!1,T,g=new Promise(N=>{T=function(I){S=!0,N(I)}}),k;try{k=a(f,p,T)}catch(N){k=Promise.reject(N)}let _=k!==!0&&c(k);if(k!==!0&&!_&&!S)return!1;let P=N=>{N.then(I=>{v(I)},I=>{let G;I&&(I instanceof Error||typeof I.message=="string")?G=I.message:G="An unexpected error occurred",v({__mozWebExtensionPolyfillReject__:!0,message:G})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return P(_?k:g),!0}),K=({reject:a,resolve:l},f)=>{o.runtime.lastError?o.runtime.lastError.message===r?l():a(new Error(o.runtime.lastError.message)):f&&f.__mozWebExtensionPolyfillReject__?a(new Error(f.message)):l(f)},$=(a,l,f,...p)=>{if(p.length<l.minArgs)throw new Error(`Expected at least ${l.minArgs} ${m(l.minArgs)} for ${a}(), got ${p.length}`);if(p.length>l.maxArgs)throw new Error(`Expected at most ${l.maxArgs} ${m(l.maxArgs)} for ${a}(), got ${p.length}`);return new Promise((v,S)=>{let T=K.bind(null,{resolve:v,reject:S});p.push(T),f.sendMessage(...p)})},J={devtools:{network:{onRequestFinished:b(y)}},runtime:{onMessage:b(W),onMessageExternal:b(W),sendMessage:$.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:$.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},C={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return s.privacy={network:{"*":C},services:{"*":C},websites:{"*":C}},w(o,J,s)};e.exports=t(chrome)}})});function O(e){var r=String(e);if(r==="[object Object]")try{r=JSON.stringify(e)}catch{}return r}var ye=(function(){function e(){}return e.prototype.isSome=function(){return!1},e.prototype.isNone=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(r){return r},e.prototype.expect=function(r){throw new Error("".concat(r))},e.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},e.prototype.map=function(r){return this},e.prototype.mapOr=function(r,t){return r},e.prototype.mapOrElse=function(r,t){return r()},e.prototype.or=function(r){return r},e.prototype.orElse=function(r){return r()},e.prototype.andThen=function(r){return this},e.prototype.toResult=function(r){return F(r)},e.prototype.toString=function(){return"None"},e.prototype.toAsyncOption=function(){return new D(x)},e})(),x=new ye;Object.freeze(x);var ve=(function(){function e(r){if(!(this instanceof e))return new e(r);this.value=r}return e.prototype.isSome=function(){return!0},e.prototype.isNone=function(){return!1},e.prototype[Symbol.iterator]=function(){var r=Object(this.value);return Symbol.iterator in r?r[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(r){return this.value},e.prototype.expect=function(r){return this.value},e.prototype.unwrap=function(){return this.value},e.prototype.map=function(r){return A(r(this.value))},e.prototype.mapOr=function(r,t){return t(this.value)},e.prototype.mapOrElse=function(r,t){return t(this.value)},e.prototype.or=function(r){return this},e.prototype.orElse=function(r){return this},e.prototype.andThen=function(r){return r(this.value)},e.prototype.toResult=function(r){return M(this.value)},e.prototype.toAsyncOption=function(){return new D(this)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Some(".concat(O(this.value),")")},e.EMPTY=new e(void 0),e})(),A=ve,B;(function(e){function r(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];for(var c=[],u=0,m=s;u<m.length;u++){var i=m[u];if(i.isSome())c.push(i.value);else return i}return A(c)}e.all=r;function t(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];for(var c=0,u=s;c<u.length;c++){var m=u[c];if(m.isSome())return m}return x}e.any=t;function o(s){return s instanceof A||s===x}e.isOption=o})(B||(B={}));var U=function(e,r,t){if(t||arguments.length===2)for(var o=0,s=r.length,n;o<s;o++)(n||!(o in r))&&(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))},xe=(function(){function e(r){if(!(this instanceof e))return new e(r);this.error=r;var t=new Error().stack.split(`
`).slice(2);t&&t.length>0&&t[0].includes("ErrImpl")&&t.shift(),this._stack=t.join(`
`)}return e.prototype.isOk=function(){return!1},e.prototype.isErr=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(r){return r},e.prototype.unwrapOr=function(r){return r},e.prototype.expect=function(r){throw new Error("".concat(r," - Error: ").concat(O(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.expectErr=function(r){return this.error},e.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: ".concat(O(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.unwrapErr=function(){return this.error},e.prototype.map=function(r){return this},e.prototype.andThen=function(r){return this},e.prototype.mapErr=function(r){return new F(r(this.error))},e.prototype.mapOr=function(r,t){return r},e.prototype.mapOrElse=function(r,t){return r(this.error)},e.prototype.or=function(r){return r},e.prototype.orElse=function(r){return r(this.error)},e.prototype.toOption=function(){return x},e.prototype.toString=function(){return"Err(".concat(O(this.error),")")},Object.defineProperty(e.prototype,"stack",{get:function(){return"".concat(this,`
`).concat(this._stack)},enumerable:!1,configurable:!0}),e.prototype.toAsyncResult=function(){return new V(this)},e.EMPTY=new e(void 0),e})();var F=xe,we=(function(){function e(r){if(!(this instanceof e))return new e(r);this.value=r}return e.prototype.isOk=function(){return!0},e.prototype.isErr=function(){return!1},e.prototype[Symbol.iterator]=function(){var r=Object(this.value);return Symbol.iterator in r?r[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(r){return this.value},e.prototype.unwrapOr=function(r){return this.value},e.prototype.expect=function(r){return this.value},e.prototype.expectErr=function(r){throw new Error(r)},e.prototype.unwrap=function(){return this.value},e.prototype.unwrapErr=function(){throw new Error("Tried to unwrap Ok: ".concat(O(this.value)),{cause:this.value})},e.prototype.map=function(r){return new M(r(this.value))},e.prototype.andThen=function(r){return r(this.value)},e.prototype.mapErr=function(r){return this},e.prototype.mapOr=function(r,t){return t(this.value)},e.prototype.mapOrElse=function(r,t){return t(this.value)},e.prototype.or=function(r){return this},e.prototype.orElse=function(r){return this},e.prototype.toOption=function(){return A(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Ok(".concat(O(this.value),")")},e.prototype.toAsyncResult=function(){return new V(this)},e.EMPTY=new e(void 0),e})();var M=we,j;(function(e){function r(u){for(var m=[],i=1;i<arguments.length;i++)m[i-1]=arguments[i];for(var d=u===void 0?[]:Array.isArray(u)?u:U([u],m,!0),h=[],w=0,b=d;w<b.length;w++){var y=b[w];if(y.isOk())h.push(y.value);else return y}return new M(h)}e.all=r;function t(u){for(var m=[],i=1;i<arguments.length;i++)m[i-1]=arguments[i];for(var d=u===void 0?[]:Array.isArray(u)?u:U([u],m,!0),h=[],w=0,b=d;w<b.length;w++){var y=b[w];if(y.isOk())return y;h.push(y.error)}return new F(h)}e.any=t;function o(u){try{return new M(u())}catch(m){return new F(m)}}e.wrap=o;function s(u){try{return u().then(function(m){return new M(m)}).catch(function(m){return new F(m)})}catch(m){return Promise.resolve(new F(m))}}e.wrapAsync=s;function n(u){return u.reduce(function(m,i){var d=m[0],h=m[1];return i.isOk()?[U(U([],d,!0),[i.value],!1),h]:[d,U(U([],h,!0),[i.error],!1)]},[[],[]])}e.partition=n;function c(u){return u instanceof F||u instanceof M}e.isResult=c})(j||(j={}));var H=function(e,r,t,o){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function u(d){try{i(o.next(d))}catch(h){c(h)}}function m(d){try{i(o.throw(d))}catch(h){c(h)}}function i(d){d.done?n(d.value):s(d.value).then(u,m)}i((o=o.apply(e,r||[])).next())})},q=function(e,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,s,n,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(i){return function(d){return m([i,d])}}function m(i){if(o)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(t=0)),t;)try{if(o=1,s&&(n=i[0]&2?s.return:i[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return t.label++,{value:i[1],done:!1};case 5:t.label++,s=i[1],i=[0];continue;case 7:i=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){t=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){t.label=i[1];break}if(i[0]===6&&t.label<n[1]){t.label=n[1],n=i;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(i);break}n[2]&&t.ops.pop(),t.trys.pop();continue}i=r.call(e,t)}catch(d){i=[6,d],s=0}finally{o=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},V=(function(){function e(r){this.promise=Promise.resolve(r)}return e.prototype.andThen=function(r){var t=this;return this.thenInternal(function(o){return H(t,void 0,void 0,function(){var s;return q(this,function(n){return o.isErr()?[2,o]:(s=r(o.value),[2,s instanceof e?s.promise:s])})})})},e.prototype.map=function(r){var t=this;return this.thenInternal(function(o){return H(t,void 0,void 0,function(){var s;return q(this,function(n){switch(n.label){case 0:return o.isErr()?[2,o]:(s=M,[4,r(o.value)]);case 1:return[2,s.apply(void 0,[n.sent()])]}})})})},e.prototype.mapErr=function(r){var t=this;return this.thenInternal(function(o){return H(t,void 0,void 0,function(){var s;return q(this,function(n){switch(n.label){case 0:return o.isOk()?[2,o]:(s=F,[4,r(o.error)]);case 1:return[2,s.apply(void 0,[n.sent()])]}})})})},e.prototype.or=function(r){return this.orElse(function(){return r})},e.prototype.orElse=function(r){var t=this;return this.thenInternal(function(o){return H(t,void 0,void 0,function(){var s;return q(this,function(n){return o.isOk()?[2,o]:(s=r(o.error),[2,s instanceof e?s.promise:s])})})})},e.prototype.toOption=function(){return new D(this.promise.then(function(r){return r.toOption()}))},e.prototype.thenInternal=function(r){return new e(this.promise.then(r))},e})();var X=function(e,r,t,o){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function u(d){try{i(o.next(d))}catch(h){c(h)}}function m(d){try{i(o.throw(d))}catch(h){c(h)}}function i(d){d.done?n(d.value):s(d.value).then(u,m)}i((o=o.apply(e,r||[])).next())})},Y=function(e,r){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,s,n,c;return c={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(i){return function(d){return m([i,d])}}function m(i){if(o)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(t=0)),t;)try{if(o=1,s&&(n=i[0]&2?s.return:i[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return t.label++,{value:i[1],done:!1};case 5:t.label++,s=i[1],i=[0];continue;case 7:i=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){t=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){t.label=i[1];break}if(i[0]===6&&t.label<n[1]){t.label=n[1],n=i;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(i);break}n[2]&&t.ops.pop(),t.trys.pop();continue}i=r.call(e,t)}catch(d){i=[6,d],s=0}finally{o=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},D=(function(){function e(r){this.promise=Promise.resolve(r)}return e.prototype.andThen=function(r){var t=this;return this.thenInternal(function(o){return X(t,void 0,void 0,function(){var s;return Y(this,function(n){return o.isNone()?[2,o]:(s=r(o.value),[2,s instanceof e?s.promise:s])})})})},e.prototype.map=function(r){var t=this;return this.thenInternal(function(o){return X(t,void 0,void 0,function(){var s;return Y(this,function(n){switch(n.label){case 0:return o.isNone()?[2,o]:(s=A,[4,r(o.value)]);case 1:return[2,s.apply(void 0,[n.sent()])]}})})})},e.prototype.or=function(r){return this.orElse(function(){return r})},e.prototype.orElse=function(r){var t=this;return this.thenInternal(function(o){return X(t,void 0,void 0,function(){var s;return Y(this,function(n){return o.isSome()?[2,o]:(s=r(),[2,s instanceof e?s.promise:s])})})})},e.prototype.toResult=function(r){return new V(this.promise.then(function(t){return t.toResult(r)}))},e.prototype.thenInternal=function(r){return new e(this.promise.then(r))},e})();function R(e,r){try{if(e)return A(new URL(e,r))}catch{}return x}function E(e){if(typeof e=="string")return{__serde_tag:"primitive",__serde_val:e};if(typeof e=="number")return{__serde_tag:"primitive",__serde_val:e};if(typeof e=="boolean")return{__serde_tag:"primitive",__serde_val:e};if(typeof e>"u")return{__serde_tag:"primitive",__serde_val:e};if(e==null)return{__serde_tag:"primitive",__serde_val:e};if(Array.isArray(e))return{__serde_tag:"array",__serde_val:e.map(r=>E(r))};if(e instanceof URL)return{__serde_tag:"url",__serde_val:e.href};if(e instanceof Headers){let r=[];return e.forEach((t,o)=>{r.push([o,t])}),{__serde_tag:"headers",__serde_val:r}}else{if(e instanceof Set)return{__serde_tag:"set",__serde_val:[...e.values()].map(E)};if(e instanceof Map)return{__serde_tag:"map",__serde_val:[...e.entries()].map(([r,t])=>[E(r),E(t)])};if(e instanceof RegExp)return{__serde_tag:"regex",__serde_val:e.source};if(B.isOption(e))return e.isSome()?{__serde_tag:"some",__serde_val:E(e.value)}:{__serde_tag:"none"};if(j.isResult(e))return e.isOk()?{__serde_tag:"ok",__serde_val:E(e.value)}:{__serde_tag:"err",__serde_val:E(e.error)};if(typeof e=="object"){let r={};for(let[t,o]of Object.entries(e))r[t]=E(o);return{__serde_tag:"object",__serde_val:r}}else throw new Error("Unreachable")}}function L(e,r=0){let t=3735928559^r,o=1103547991^r;for(let s=0,n;s<e.length;s++)n=e.charCodeAt(s),t=Math.imul(t^n,2654435761),o=Math.imul(o^n,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(o^o>>>13,3266489909),o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&o)+(t>>>0)}var lr=new BroadcastChannel("worker_service");var z={FromInjectedToService:0,FromContentToService:1,FromServiceToWorker:2,FromWorkerToService:3,FromUntrustedInjectedToTrusted:4,FromTrustedInjectedToUntrusted:5,FromServiceToContent:6,FromServiceToInjected:7,FromServiceToService:8};var Z=new BroadcastChannel(`injected-${L(window.location.href)}`);function oe(e){let r=z.FromTrustedInjectedToUntrusted;Z.postMessage({msg:e,channel:r})}function se(e){let r=t=>{let o=t.data.msg;t.data.channel==z.FromUntrustedInjectedToTrusted&&e(o)};return Z.addEventListener("message",r),()=>{Z.removeEventListener("message",r)}}var le=Ae(ae(),1);async function be(e,r){await le.default.runtime.sendMessage({msg:e,channel:r})}function ue(e){let r=z.FromInjectedToService;be(e,r)}(async()=>await new Promise(e=>{let r=se(async t=>{if(t.name!="instagram_on_media")return;let o=t.data.media_id;if(!o){console.error(`No media id provided for ${t.data.media_type}`);return}try{t.data.media_type=="reel"?await Ie(o):t.data.media_type=="post"?await Fe(o):t.data.media_type=="story"&&await ke(o)}catch(s){console.error(`Error while fetching media type: ${t.data.media_type} with id ${o}`),console.error(s)}e()});oe({name:"instagram_request_media",data:null})}))();function re(e){ue({name:"on_media",data:{media:E(e)}})}async function me(e){let r=new URLSearchParams({variables:JSON.stringify({shortcode:e,fetch_tagged_user_count:null,hoisted_comment_id:null,hoisted_reply_id:null}),server_timestamps:"true",doc_id:"8845758582119845"});return(await fetch("https://www.instagram.com/graphql/query",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","X-FB-Friendly-Name":"PolarisPostActionLoadPostQueryQuery"},body:r})).json()}async function ke(e){let r=window.location.href,t=/https:\/\/www\.instagram\.com\/stories\/([^/]+)\/(\d+)/.exec(r);if(!t){console.error("Invalid URL format for Instagram story.");return}let[o,s,n]=t,u=await(await fetch(window.location.href,{method:"GET",credentials:"same-origin"})).text(),m=/"user_id":"(\d+)"/.exec(u);if(!m||m.length<2){console.error("Unable to extract user ID from the page.");return}let i=m[1];if(!i){console.error("Unable to extract user ID.");return}let d=s!=="highlights"?i:`highlight:${n}`,h=await fetch(`https://www.instagram.com/api/v1/feed/reels_media/?media_id=${n}&reel_ids=${d}`,{headers:{Accept:"application/json","X-IG-App-ID":"936619743392459","X-ASBD-ID":"198387","X-IG-WWW-Claim":"0",Origin:"https://www.instagram.com"},credentials:"same-origin"});if(!h.ok){console.error("Failed to fetch story videos information.");return}let b=(await h.json()).reels?.[d]?.items;if(!b){console.log("No videos found for this story.");return}for(let y of b){if(!y.video_versions||!y.video_versions[0]||y.pk!=n)continue;let W=y.video_versions.reduce((a,l)=>l.height>a.height?l:a,y.video_versions[0]).url,K=y.taken_at,$=new Date(parseInt(K)*1e3).toLocaleDateString(),J=`Story by ${s} on ${$}`,C=R(y.image_versions2?.candidates?.[0]?.url);C.isSome()&&(C=await te(C.value)),C||console.error("No thumbnail, continuing anyways."),re({is_youtube:!1,url:new URL(W),initiator:R(window.location.href),hash:`media_hash_${L(e)}`,sent_headers:new Headers,thumbnail_url:C,libav_demuxer:A("mp4"),extension:"mp4",title:A(J),size:x,type:"http",supports_byte_ranges:!1,discovery_timestamp_ms:Date.now()})}}async function Fe(e){let r=await me(e),t=r?.data?.xdt_shortcode_media?.video_url;if(!t){console.error(`Video URL not found for media id ${e}`);return}let o=R(r?.data?.xdt_shortcode_media?.thumbnail_src);o.isSome()&&(o=await te(o.value)),o||console.error(`No thumbnail for media with id ${e}. Continuing anyways.`);let s=r?.data?.xdt_shortcode_media?.owner?.username,n=r?.data?.xdt_shortcode_media?.taken_at_timestamp,c=new Date(parseInt(n)*1e3).toLocaleDateString(),u=`Post by ${s} on ${c}`;re({is_youtube:!1,url:new URL(t),initiator:R(window.location.href),hash:`media_hash_${L(e)}`,sent_headers:new Headers,thumbnail_url:o,libav_demuxer:A("mp4"),extension:"mp4",title:A(u),size:x,type:"http",supports_byte_ranges:!1,discovery_timestamp_ms:Date.now()})}async function Ie(e){let r=await me(e),t=r?.data?.xdt_shortcode_media?.video_url;if(!t){console.error(`Video URL not found for media ID ${e}`);return}let o=r?.data?.xdt_shortcode_media?.owner?.username,s=r?.data?.xdt_shortcode_media?.taken_at_timestamp,n=new Date(parseInt(s)*1e3).toLocaleDateString(),c=`Reel by ${o} on ${n}`,u=R(r?.data?.xdt_shortcode_media?.thumbnail_src);u.isSome()&&(u=await te(u.value)),u||console.error("No thumbnail, continuing anyways."),re({is_youtube:!1,url:new URL(t),initiator:R(window.location.href),hash:`media_hash_${L(e)}`,sent_headers:new Headers,thumbnail_url:u,libav_demuxer:A("mp4"),extension:"mp4",title:A(c),size:x,type:"http",supports_byte_ranges:!1,discovery_timestamp_ms:Date.now()})}var Me=10,ee=[];async function te(e){try{let t=await(await fetch(e)).blob(),o=URL.createObjectURL(t);return ee.length>Me&&URL.revokeObjectURL(ee.shift()),ee.push(o),A(new URL(o))}catch(r){return console.error(r),x}}
